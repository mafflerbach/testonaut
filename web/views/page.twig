{% include 'head.twig' %}
{% include 'headNavi.twig' %}

<div class="row">
  <div class="col-xs-6 col-md-3">
    {{ app.menu|raw }}
  </div>
  <div class="col-xs-12 col-md-9">

    <div class="content">
      {{ app.request.content|raw }}
    </div>

    <div class="screens">
      {% if app.request.images is defined %}
        {% for key, val  in app.request.images %}

          <h4 id="{{ key }}">{{ key }}</h4>
          {% for image in val.src %}
            <div class="compare">
              <div class="image">
                <a href="{{ app.request.imagePath }}/{{ key }}/src/{{ image }}">
                  <img src="{{ app.request.imagePath }}/{{ key }}/src/{{ image }}"/>
                </a>

                <span class="ops">
                  <span class="desc">
                    {{ image }}
                  </span>
                  <a class="copyImage"
                     href="{{ app.request.baseUrl }}/image/copy/{{ key }}/{{ image }}/{{ app.request.path }}">
                    <span class="copy glyphicon glyphicon-ok-sign"
                          data-link="{{ app.request.baseUrl }}/image/copy/{{ key }}/{{ image }}/{{ app.request.path }}">
                    </span>
                  </a>
                  <a class="deleteImage"
                     href="{{ app.request.baseUrl }}/image/delete/src/{{ key }}/{{ image }}/{{ app.request.path }}">
                    <span class="delete glyphicon glyphicon-remove-sign"
                          data-link="{{ app.request.baseUrl }}/image/delete/src/{{ key }}/{{ image }}/{{ app.request.path }}">
                    </span>
                  </a>
                </span>

              </div>

              <div class="image">
                <a href="{{ app.request.imagePath }}/{{ key }}/ref/{{ image }}">
                  <img src="{{ app.request.imagePath }}/{{ key }}/ref/{{ image }}"/></a>
                <span class="ops">
                  <span class="desc">
                    {{ image }}
                  </span>
                  <a class="deleteImage"
                     href="{{ app.request.baseUrl }}/image/delete/ref/{{ key }}/{{ image }}/{{ app.request.path }}">
                    <span class="delete glyphicon glyphicon-remove-sign"
                          data-link="{{ app.request.baseUrl }}/image/delete/ref/{{ key }}/{{ image }}/{{ app.request.path }}">
                    </span>
                  </a>
                </span>
              </div>

              <div class="image">
                <a href="{{ app.request.imagePath }}/{{ key }}/comp/{{ image }}">
                  <img src="{{ app.request.imagePath }}/{{ key }}/comp/{{ image }}"/></a>
                <span class="ops">
                  <span class="desc">
                    {{ image }}
                  </span>
                  <a class="deleteImage"
                     href="{{ app.request.baseUrl }}/image/delete/comp/{{ key }}/{{ image }}/{{ app.request.path }}">
                    <span class="delete glyphicon glyphicon-remove-sign"
                          data-link="{{ app.request.baseUrl }}/image/delete/comp/{{ key }}/{{ image }}/{{ app.request.path }}">
                    </span>
                  </a>
                </span>
              </div>
            </div>
          {% endfor %}
        {% endfor %}
      {% endif %}
    </div>


    {% if app.request.lastResult|length  > 0 %}
      <div class="suiteResult">
        <div class="panel">
          <div class="panel-heading"><h3>Browser Results</h3></div>
          <div class="panel-body">
            {% for key, val  in app.request.lastResult %}
              <h4>{{ key }}</h4>
              {% for key, run in val.run %}
                {% if val.result[key] == true %}
                  {% set pathclass = 'panel-success' %}
                {% else %}
                  {% set pathclass = 'panel-danger' %}
                {% endif %}
                <div class="panel {{ pathclass }}">
                  <div class="panel-heading"><a
                      href="{{ app.request.baseUrl }}/{{ val.path[key] }}">{{ val.path[key] }}</a></div>
                  <div class="panel-body">
                    <ul class="list-group">
                      {% for step in run %}
                        {% if step.0 == true %}
                          {% set class = 'list-group-item-success' %}
                        {% else %}
                          {% set class = 'list-group-item-success' %}
                        {% endif %}
                        <li class="{{ class }} list-group-item">
                          {{ step.1 }}
                        </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        </div>
      </div>
    {% endif %}

    <div class="pulsarbox">
    </div>
    <div class="result">
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
        <p>One fine body&hellip;</p>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<script type="text/javascript">
  $(document).ready(function () {
    $('.resultBtn a').click(function (e) {
      e.preventDefault();
    });

    $('.resultBtn').on('click', function () {
      if ($('.lastResultRun:visible').length == 0) {
        $(this).next().show('slow');
      } else {
        $(this).next().hide('slow');
      }
    });

    $('.panel-heading').on('click', function () {
      if ($(this).next(':visible').length == 0) {
        $(this).next().slideDown('slow');
      } else {
        $(this).next().slideUp('slow');
      }
    });
    $('table').addClass('table table-bordered');

    $('.copyImage').click(function (e) {
      e.preventDefault();
      var href = $(this).attr('href');
      modalHandling(href, "Copy Image", '');
    });

    $('.deleteImage').click(function (e) {
      e.preventDefault();
      var href = $(this).attr('href');
      modalHandling(href, "Delete Image", '');
    });


    $("a[data-action='delete']").click(function (e) {
      e.preventDefault();
      var href = $(this).attr('href');
      modalHandling(href, "Delete Page", "/");
    });

  });

  function modalHandling(href, modalTitle, ending) {

    $.ajax({
      method: "get",
      url: href
    }).done(function (data) {
      $('.modal-title').empty().append(modalTitle);
      $('.modal-body').empty().append($(data).find('.content'));
      $('#myModal').modal('show');

      $('.backLink').click(function (ev) {
        ev.preventDefault();
        $('#myModal').modal('hide');
      });

      $('.btn-action').click(function (ev) {
        ev.preventDefault();

        $.ajax({
          method: "post",
          url: href + ending
        }).done(function (data) {
          $('.modal-body').empty().append($(data).find('.content'));
        });
      });
    });
  }

</script>

{% include 'footer.twig' %}
